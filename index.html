<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dira Diagnosis - Cryptodira Token Health Check</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      font-size: 16px;
      text-align: center;
    }
    .container {
      padding: 1rem;
      max-width: 800px;
      margin: 0 auto;
    }
    #dira-diagnosis-results {
      max-height: 400px;
      overflow-y: auto;
      background: #fff;
      padding: 1rem;
      margin-top: 1rem;
      border: 1px solid #dee2e6;
      border-radius: 0.25rem;
    }
    .btn {
      font-size: 16px;
      margin-bottom: 1rem;
      padding: 0.5rem 1.5rem;
    }
    .btn:active {
      opacity: 0.7;
    }
    @media (max-width: 576px) {
      h1 { font-size: 1.5rem; }
      .btn { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Dira Diagnosis - Cryptodira Token Health Check</h1>
    <button class="btn btn-warning" onclick="checkDIRADiagnosis()">Run Dira Diagnosis</button>
    <div id="dira-diagnosis-results"></div>
  </div>

  <script src="/js/solana-web3.js"></script> <!-- Local library -->
  <script src="/js/solana-spl-token.js"></script> <!-- Local library -->
  <script>
    // Check if Solana Web3.js loaded correctly
    if (typeof window.web3 !== 'undefined' && window.web3.PublicKey) {
      console.log('Solana Web3.js loaded successfully');
    } else {
      console.error('Solana Web3.js not loaded. Check file path or content.');
    }

    // Initialize DOM elements
    const diraDiagnosisResults = document.getElementById('dira-diagnosis-results');

    const connection = new Connection('https://api.mainnet-beta.solana.com', 'confirmed');
    const tokenMint = new PublicKey('53hZ5wdfphd8wUoh6rqrv5STvB58yBRaXuZFAWwitKm8');

    // Dira Diagnosis Function (Near-Real-Time, Client-Side)
    async function checkDIRADiagnosis() {
      diraDiagnosisResults.innerHTML = '<p class="text-info">Analyzing DIRA status...</p>';
      try {
        // Hardcode DIRA token address for analysis
        const diraMint = new PublicKey('53hZ5wdfphd8wUoh6rqrv5STvB58yBRaXuZFAWwitKm8');

        // Open Solscan for DIRA in a new tab for manual verification
        const solscanUrl = `https://solscan.io/token/${diraMint.toString()}`;
        window.open(solscanUrl, '_blank');

        // Perform near-real-time client-side analysis using Solana RPC
        const tokenSupply = await getTokenSupply(diraMint);
        const holders = await getTokenHolders(diraMint); // Limited by front-end, placeholder
        const liquidityStatus = await checkLiquidity(diraMint);
        const recentVolume = await getRecentVolume(diraMint);

        // Generate a status, rating, and suggestions based on heuristics
        let diagnosis = `<p class="text-success">Dira Diagnosis Report for token: ${diraMint.toString()}</p>`;
        diagnosis += '<p>Current Status (as of ' + new Date().toLocaleString() + '):</p>';
        diagnosis += `
          <ul>
            <li><strong>Total Supply:</strong> ${tokenSupply / 1e4} DIRA (${formatNumber(tokenSupply)} smallest units, decimals = 4)</li>
            <li><strong>Number of Holders:</strong> ${holders.length || 'Unknown (verify on Solscan)'} (expected 57 per tokenomics)</li>
            <li><strong>Market Cap:</strong> ~$808.48 (verify on Solscan, price $0.0001652 per tokenomics)</li>
            <li><strong>Recent Transactions:</strong> ${recentVolume || 'Unknown (verify on Solscan)'} transfers in last 24 hours (expected ~749 total per tokenomics)</li>
            <li><strong>Liquidity Status:</strong> ${liquidityStatus} - Verify on Solscan or Raydium (${formatRaydiumPool()}) for locked status.</li>
          </ul>
        `;

        // Assign risk rating based on heuristics
        const rating = calculateRiskRating(tokenSupply, holders, liquidityStatus, recentVolume);
        diagnosis += `<p><strong>Risk Rating:</strong> ${rating}</p>`;

        // Provide suggestions for improvement
        const suggestions = generateSuggestions(rating, liquidityStatus, holders);
        diagnosis += '<p><strong>Suggestions for Improvement:</strong></p>' + suggestions;

        diagnosis += '<p>Instructions: Review Solscan data in the new tab for detailed transactions, holders, and market activity. Look for red flags like unlocked liquidity, active mint authority, or concentrated holdings (top 10 holders >30% of supply).</p>';

        diraDiagnosisResults.innerHTML = diagnosis;

        // Near-real-time updates (every 30 seconds, within RPC limits)
        setInterval(checkDIRADiagnosis, 30000); // Update every 30 seconds
      } catch (err) {
        console.error('Dira Diagnosis failed', err);
        diraDiagnosisResults.innerHTML = `<p class="text-danger">Error in Dira Diagnosis: ${err.message || 'Unknown error'}. Check console for details.</p>`;
      }
    }

    // Helper: Get token supply (using Solana RPC, near-real-time)
    async function getTokenSupply(m
